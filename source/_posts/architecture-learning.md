---
title: Architecture Learning(WIP)
date: 2024-03-08 14:55:28
tags:
    - architecture
categories: 
    - general
lang: zh-CN
---

# 前言

在过去，我曾将架构视为一门纯粹的技术领域。然而，随着我亲自深入服务器管理和服务搭建的实践，我逐渐领悟到架构其实是一套旨在解决关键问题的方法论——即**如何在资源有限的条件下寻找最优解**。这让我认识到，我所学习的一切，都应该围绕这一核心问题展开。

架构的思考可以从两个主要方面入手：

- **评估：** 对项目进行全面分析，确定完成目标所需的资源量，以及我们能够调动的资源量。在现有资源限制下，是否有可能实现目标？能否用更少的资源达到同样的效果？

- **设计：** 评估完成后，基于可用资源进行架构设计，这可能涉及到服务器资源配置、研发资源分配、团队协作、技术实现选型等多个层面。

作为架构师，不可忽视评估与设计这两个环节。尤其是评估阶段，它经常被忽略。有时候，我们可能轻易地认为某个目标不可实现，但应反复探索是否存在其他路径，通过更少的资源或在可接受的牺牲条件下实现目标。

我倾向于从更宏观的角度去思考架构问题。因为我们面临的挑战不仅仅是技术问题。从项目构建到团队合作、从技术选型到项目管理，我希望能够培养出一种思维方式，而不仅仅是掌握具体的实现工具。

接下来，我将基于《亿级流量：网站架构核心技术》一书，深化我的架构知识。我会结合书中内容和个人思考记录笔记。这本书是一位前领导推荐的架构入门读物，我期待它能帮助我达到新的高度。

# 原则

## 墨菲定律、康威定律和二八定律

在构建系统架构时，吸纳和运用跨领域内的核心原则不仅能提高系统的健壮性、效率和可维护性，而且能够指引我们避免常见陷阱。三个广泛认知的原则——墨菲定律、康威定律和二八定律来为我们提供通用的策略和思路

### 墨菲定律

墨菲定律的精髓在于 **“凡是可能出错的事，总会出错”** 。这个看似悲观的原则其实是一种强大的风险管理工具，提醒我们在设计时预见最坏的情况，并提前准备应对策略。

**应用策略：**

- **设计冗余**: 系统设计时考虑到可能的失败点，并提前设计好备份或冗余机制，以保证系统在组件失败时能够持续运作。
- **容错机制**: 实现容错机制，如异常处理、事务回滚等，确保系统在面临意外情况时能够优雅地恢复。
- **灾难恢复计划**: 制定和测试灾难恢复计划，确保在极端情况下能够迅速恢复服务。

### 康威定律

康威定律：**“系统设计（架构）会被限制于创建这些系统的组织结构。”** 这意味着组织的沟通结构将直接影响到最终系统设计的形状。这揭示了系统设计与创造它的组织结构之间的内在联系，强调了沟通结构对架构成果的影响。

**应用策略：**

- **组织结构调整**: 根据所需的架构目标，调整团队结构，以促进更有效的沟通和合作，确保架构设计能够顺利实施。
- **跨部门合作**: 鼓励跨职能团队的合作，打破部门间的壁垒，促进更灵活和创新的系统设计。
- **架构一致性**: 维护架构决策的一致性和清晰性，确保各团队朝着共同的目标努力，减少架构腐化的风险。

## 二八定律（帕累托原则）

帕累托原则指出 **“80%的效果来自20%的原因”** ，提示我们识别并集中资源于那些最具影响力的领域。这就跟《毛选》里面说的一样，我们应该集中最大的力量去解决更紧迫更具体的需求，这样才能更好更快的达成目标。

**应用策略：**

- **性能优化**：识别并优化那20%可能造成80%性能瓶颈的代码或组件。
- **功能开发**：优先开发那20%对用户最重要的功能，以提高用户满意度和业务价值。
- **问题解决**：针对导致大多数问题的根本原因进行解决，而非仅仅修复表面症状。

每个原则都提供了一种视角，它们帮助我们在复杂的系统设计过程中，做出更加明智的决策。通过对这三个原则的深入理解与应用，我们可以更有效地规避潜在的风险，减少团队的人效困境，同时提高系统的性能和用户满意度。

## 高并发原则

### 为什么无状态设计容易进行水平扩展？

- **无需维护客户端状态**: 由于每个请求都是自包含的，服务器不需要跟踪或维护客户端的状态信息，这简化了数据管理和同步的需求。

- **负载均衡的简化**: 无状态应用程序更容易实现负载均衡。请求可以被任意地分配到集群中的任何服务器上，而不需要担心用户状态和数据的连续性问题。

- **弹性和可伸缩性**: 无状态架构允许系统根据需要动态添加或移除资源。这意味着应用可以根据需求轻松扩展（水平扩展）或缩减，提高资源利用效率和成本效益。

- **容错性和恢复能力**: 在无状态设计中，如果某个服务器失败，其他服务器可以无缝地接管请求，因为没有必要访问存储在故障服务器上的状态信息。

> **示例** 
> 
> 一个典型的无状态设计示例是基于HTTP协议的Web应用。HTTP本身是一个无状态协议，意味着每个请求都是独立的，不依赖于之前的请求。在这种设计下，Web服务器不会保存任何用户的状态信息（如登录状态、浏览历史等）。这种无状态的Web应用可以非常容易地通过增加更多的Web服务器来实现水平扩展，每个服务器都可以独立处理进来的请求。
> 
> 例如，一个电子商务平台的产品目录服务可以设计成无状态的。当用户浏览产品时，每个请求都包含了获取特定产品信息所需的全部信息（如产品ID）。服务器处理这个请求，返回产品的详细信息，而不需要知道用户之前的浏览历史。这样，该服务就可以通过增加更多的服务器实例来轻松扩展，每个实例都能独立响应用户请求，提高系统的吞吐量和可用性。

### 服务化：逐步深化以满足需求

服务化是指将应用程序的不同功能模块化并作为独立服务部署的过程，它显著提升了软件的可维护性、可扩展性和复用性。随着服务化程度的增加，我们见证了从简单结构到复杂系统、从初级优化到高级治理的转变。

#### 进程内服务：基础模块化

- **概念**：功能模块以库或类的形式存在于单一应用进程中，通过直接方法调用实现服务。
- **示例**：一个Web应用中，用户认证和数据库访问等功能以不同的类或库形式实现，并在同一进程中运行。此方法简单直接，但在灵活性和扩展性方面有所不足。

#### 单机远程服务：初步独立

- **概念**：功能模块作为独立服务在单服务器上运行，通过网络协议（如HTTP、RPC）进行远程调用。
- **示例**：用户认证功能被拆分为独立服务，在同一台服务器的不同进程中运行，并通过HTTP API进行服务调用。这提高了模块独立性，但仍限于单机资源。

#### 集群手动注册服务：提升可用性

- **概念**：服务部署于多机集群，地址和端口通过中心或配置文件手动注册，以便消费者发现和调用。
- **示例**：用户认证服务在多机集群中运行，服务地址通过共享配置文件手动配置。客户端根据配置发现并调用服务，增强了服务的可用性和负载处理能力，但增加了管理复杂度。

#### 自动注册与发现服务：简化管理

- **概念**：服务启动时自动注册到服务注册中心，消费者通过查询注册中心自动发现服务地址。
- **示例**：用户认证服务启动时，自动注册其地址到如Consul或Eureka的服务注册中心。客户端应用通过查询注册中心自动获得服务地址，极大简化了服务管理和发现过程。

#### 服务的分组/隔离/路由：增加灵活性

- **概念**：基于服务版本、租户或其他属性进行服务分组或隔离，并根据请求特征智能路由。
- **示例**：用户认证服务可按版本或用户群体隔离，并通过API网关根据请求的版本号或用户属性进行路由。这提升了服务灵活性和可维护性。

#### 服务治理：确保高可用性

- **概念**：包括监控、容错、负载均衡、限流、熔断等机制，确保服务高可用性和稳定性。
- **示例**：对用户认证服务实施服务治理，实现服务健康监控、自动扩缩容、请求限流和熔断机制等。使用如Netflix Hystrix的框架支持这些功能。

通过以上递进介绍，服务架构从简单的进程内调用发展至可自管理和治理的分布式服务网络。每个阶段都增强了服务的独立性、扩展性和可靠性，同时也带来了更高的管理复杂度。设计服务架构时，应根据具体需求和资源状况，权衡不同服务化级别的适用性。

## 高可用原则

## 业务设计原则
